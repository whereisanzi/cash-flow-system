graph TB
  subgraph PACELCTheorem[PACELC Theorem - Extended CAP Analysis]
    subgraph PACELCDefinition[PACELC: If Partition then Availability vs Consistency; Else Latency vs Consistency]
      PartitionScenario[During Network Partition<br/>Choose Availability OR Consistency]
      NormalScenario[During Normal Operation<br/>Choose Latency OR Consistency]
    end
  end

  subgraph CashFlowPACELC[Cash Flow System PACELC Analysis]
    subgraph PartitionChoice[Partition Scenario - PA/EL]
      DuringPartition[During Network Partition<br/>âœ… Choose AVAILABILITY over Consistency<br/>â€¢ Transactions continue processing<br/>â€¢ Consolidations may lag behind<br/>â€¢ System remains operational<br/>â€¢ Data eventually reconciles]
    end

    subgraph NormalChoice[Normal Operation - EL]
      DuringNormalOp[During Normal Operation<br/>âœ… Choose LATENCY over Consistency<br/>â€¢ Fast transaction responses<br/>â€¢ Async consolidation updates<br/>â€¢ Better user experience<br/>â€¢ Acceptable eventual consistency]
    end
  end

  subgraph ImplementationEvidence[Implementation Evidence]
    subgraph PartitionEvidence[Partition Tolerance Evidence]
      NetworkSegregation[Network Segregation<br/>ğŸ”— transactions_network 172.20.0.0/24<br/>ğŸ”— consolidations_network 172.21.0.0/24<br/>ğŸ”— Services survive network splits<br/>ğŸ”— Independent operation capability]

      MessagePersistence[Message Persistence<br/>ğŸ“¦ RabbitMQ persistence enabled<br/>ğŸ“¦ Dead Letter Queue DLQ<br/>ğŸ“¦ Message durability guaranteed<br/>ğŸ“¦ No data loss during partitions]
    end

    subgraph LatencyOptimization[Latency Optimization Evidence]
      AsyncProcessing[Asynchronous Processing<br/>âš¡ Fire-and-forget event publishing<br/>âš¡ Non-blocking transaction responses<br/>âš¡ Background consolidation updates<br/>âš¡ PgBouncer connection pooling]

      CachingStrategy[Performance Optimizations<br/>ğŸš€ Connection pooling PgBouncer<br/>ğŸš€ Load balancing HAProxy<br/>ğŸš€ Multiple service instances<br/>ğŸš€ Minimal API overhead]
    end
  end

  subgraph PerformanceMetrics[Performance Metrics Supporting PACELC Choice]
    subgraph LatencyMetrics[Latency Achievements]
      TransactionLatency[Transaction API Latency<br/>âœ… p95: 27.07ms Target <2000ms<br/>âœ… Fast response times maintained<br/>âœ… User experience optimized]

      ConsolidationLatency[Consolidation API Latency<br/>âœ… p95: 12.4ms Target <3000ms<br/>âœ… Read operations optimized<br/>âœ… Query performance excellent]
    end

    subgraph AvailabilityAchieved[Availability Achievements]
      UptimeMetrics[High Availability Results<br/>âœ… 100% transaction availability during stress<br/>âœ… 0 independence violations<br/>âœ… Services survive consolidation overload<br/>âœ… No single point of failure]

      ConsistencyConvergence[Consistency Convergence<br/>âœ… 100% eventual consistency achieved<br/>âœ… 38s average convergence time<br/>âœ… All events eventually processed<br/>âœ… Data integrity maintained]
    end
  end

  subgraph BusinessAlignment[Business Requirements Alignment]
    subgraph CriticalPath[Critical Business Path]
      TransactionCriticality[Transaction Processing - Critical<br/>ğŸ’ Revenue-generating operations<br/>ğŸ’ Must never be unavailable<br/>ğŸ’ Customer-facing experience<br/>ğŸ’ Real-time requirement]

      ReportingCriticality[Consolidation Reporting - Important<br/>ğŸ“Š Management information<br/>ğŸ“Š Can tolerate brief delays<br/>ğŸ“Š Eventual accuracy acceptable<br/>ğŸ“Š Batch-oriented processing]
    end

    subgraph PAELCAlignment[PACELC Alignment with Business]
      PartitionAlignment[Partition Scenario Alignment<br/>âœ… Keep transactions available during network issues<br/>âœ… Revenue protection prioritized<br/>âœ… Reports can wait for network recovery<br/>âœ… Business continuity maintained]

      LatencyAlignment[Normal Operation Alignment<br/>âœ… Fast transaction responses improve UX<br/>âœ… Async reporting reduces wait times<br/>âœ… Better resource utilization<br/>âœ… Cost-effective architecture]
    end
  end

  subgraph ComparisonWithAlternatives[Comparison with Alternative PACELC Choices]
    subgraph PCECChoice[PC-EC Alternative - Strong Consistency]
      PCECTradeoffs[âŒ PC-EC Would Require<br/>â€¢ Synchronous replication<br/>â€¢ Distributed transactions 2PC<br/>â€¢ Higher latency for all operations<br/>â€¢ Risk of availability loss<br/>â€¢ Complex failure scenarios]
    end

    subgraph PAECChoice[PA-EC Alternative - Availability and Consistency]
      PAECTradeoffs[âŒ PA-EC Would Require<br/>â€¢ Complex consistency protocols<br/>â€¢ Vector clocks or similar<br/>â€¢ Higher operational complexity<br/>â€¢ Increased latency overhead<br/>â€¢ Diminished partition tolerance]
    end
  end

  subgraph MonitoringStrategy[Monitoring Strategy for PACELC]
    subgraph ConsistencyMonitoring[Consistency Monitoring]
      EventualConsistencyTracking[Eventual Consistency Tracking<br/>ğŸ“ˆ Convergence time measurement<br/>ğŸ“ˆ DLQ message monitoring<br/>ğŸ“ˆ Data reconciliation alerts<br/>ğŸ“ˆ Consistency SLA tracking]
    end

    subgraph LatencyMonitoring[Latency Monitoring]
      ResponseTimeTracking[Response Time Monitoring<br/>â±ï¸ p95/p99 latency alerts<br/>â±ï¸ SLO-based thresholds<br/>â±ï¸ Performance regression detection<br/>â±ï¸ User experience metrics]
    end

    subgraph AvailabilityMonitoring[Availability Monitoring]
      UptimeTracking[Availability Tracking<br/>ğŸ¯ Service uptime monitoring<br/>ğŸ¯ Partition detection alerts<br/>ğŸ¯ Independence validation<br/>ğŸ¯ Business impact assessment]
    end
  end

  %% Relationships
  PartitionScenario --> DuringPartition
  NormalScenario --> DuringNormalOp

  DuringPartition --> NetworkSegregation
  DuringPartition --> MessagePersistence
  DuringNormalOp --> AsyncProcessing
  DuringNormalOp --> CachingStrategy

  AsyncProcessing --> TransactionLatency
  CachingStrategy --> ConsolidationLatency
  NetworkSegregation --> UptimeMetrics
  MessagePersistence --> ConsistencyConvergence

  TransactionCriticality --> PartitionAlignment
  ReportingCriticality --> LatencyAlignment

  %% Styling
  classDef theorem fill:#fff3e0,stroke:#f57c00,stroke-width:4px
  classDef ourChoice fill:#e8f5e8,stroke:#2e7d32,stroke-width:3px
  classDef evidence fill:#e3f2fd,stroke:#1976d2,stroke-width:2px
  classDef metrics fill:#f3e5f5,stroke:#7b1fa2,stroke-width:2px
  classDef business fill:#e1f5fe,stroke:#0277bd,stroke-width:2px
  classDef monitoring fill:#e8eaf6,stroke:#3f51b5,stroke-width:2px
  classDef alternatives fill:#ffebee,stroke:#d32f2f,stroke-width:2px

  class PACELCDefinition,PartitionScenario,NormalScenario theorem
  class PartitionChoice,NormalChoice,DuringPartition,DuringNormalOp ourChoice
  class PartitionEvidence,LatencyOptimization,NetworkSegregation,MessagePersistence,AsyncProcessing,CachingStrategy evidence
  class LatencyMetrics,AvailabilityAchieved,TransactionLatency,ConsolidationLatency,UptimeMetrics,ConsistencyConvergence metrics
  class BusinessAlignment,CriticalPath,PAELCAlignment,TransactionCriticality,ReportingCriticality,PartitionAlignment,LatencyAlignment business
  class MonitoringStrategy,ConsistencyMonitoring,LatencyMonitoring,AvailabilityMonitoring,EventualConsistencyTracking,ResponseTimeTracking,UptimeTracking monitoring
  class ComparisonWithAlternatives,PCECChoice,PAECChoice,PCECTradeoffs,PAECTradeoffs alternatives
